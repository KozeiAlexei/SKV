@{
    string app = ClientSideConfiguration.AngularApplicationName;
    string controller = ClientSideConfiguration.AngularUserManagerController;
    string controller_name = ClientSideConfiguration.AngularUserManagerControllerName;

    string ut_factory = ClientSideConfiguration.AngularUserTableSettingsFactory;


    string user_profile_modal = ClientSideConfiguration.UserProfileModalName;
    string confirmation_modal = ClientSideConfiguration.ConfirmationModalName;
}

<script type="text/javascript">
    angular.module('@app').controller('@controller', ['$scope', '@ut_factory', '$tools', '$users', '$roles',
    function ($scope, @ut_factory, $tools, $users, $roles) {
        var self = this;

        self.UISetting = function() {
            $scope.TableManagment.Columns(@(ut_factory).Columns());

            $scope.TableManagment.Editable(@(ut_factory).Editable());
            $scope.TableManagment.Paginable(@(ut_factory).Paginable());
            $scope.TableManagment.Filterable(@(ut_factory).Filterable());

            $scope.TableManagment.PageSize(@(ut_factory).PageSize());

            var actions = @(ut_factory).Actions();

            @(ut_factory).SetActionClickById(actions, '@ClientSideConfiguration.ViewActionId', self.OpenUserProfileModal);
            @(ut_factory).SetActionClickById(actions, '@ClientSideConfiguration.DeleteActionId', self.OpenDeleteUserModal);

            $scope.TableManagment.SetActions(actions)
            $scope.TableManagment.SetTableManagmentPanelCode(@(ut_factory).BottomManagmentPanel());
        }


        self.Initialize = function () {
            self.CurrentUser = {};
            self.DropdownData = {}

            self.ModelState = {};
            self.ModelStateFlag = true;

            self.UISetting();
            self.FetchingData();
        };

        self.OpenUserProfileModal = function (row) {
            self.CurrentUser = ToolsService.Copy(row);
            $tools.ShowModal('@user_profile_modal');
        }

        self.CloseUserProfileModal = function () {
            $tools.HideModal('@user_profile_modal');
        }

        self.OpenDeleteUserModal = function (row) {
            $tools.ShowModal('@confirmation_modal')
        }

        self.FetchingData = function() {
            $roles.GetRoles(function(roles) {
                self.DropdownData.Roles = roles;
                self.GetUsers();
            });
        }

        self.GetUsers = function () {
            $users.GetUsers(function (users) {
                var data = [];
                angular.forEach(users, function (user) {
                    data.push({ Data: user });
                });

                $scope.TableManagment.LoadData(data);
            })
        }

        self.UpdateUserData = function () {
            if (self.ValidateUserProfileData(self.CurrentUser)) {
                $users.UpdateUserData(self.CurrentRow, function (result) {

                });
            }
        }

        self.CreateUser = function () {
            $tools.ShowModal('@user_profile_modal');
        }

        self.OpenDeleteUserModal = function (row) {
            $tools.ShowModal('@confirmation_modal')
        }

        self.ValidateUserProfileData = function (model) {
            self.ModelStateFlag = true;

            self.ModelState.UserName = self.ValidateField(model.UserName);
            self.ModelState.Email = self.ValidateField(model.Email);
            self.ModelState.Profile = {};
            self.ModelState.Profile.Name = self.ValidateField(model.Profile.Name);

            return self.ModelStateFlag;
        }


        self.ValidateField = function (field_value, custom_validation_func) {
            var result = true & !ToolsService.IsNullOrEmpty(field_value);
            if (custom_validation_func != undefined)
                result &= custom_validation_func(field_value);

            self.ModelStateFlag &= result;
            if (!result)
                return 'border-color : #ff0000';

            return 'border-color : #00ff00';
        }


        self.Initialize()
}])
</script>
