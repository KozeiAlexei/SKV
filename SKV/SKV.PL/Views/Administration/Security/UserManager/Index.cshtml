@using SKV.PL.ClientSide.Concrete;
@using SKV.PL.ClientSide.Abstract.Components

@using SKV.PL.ClientSide.Components
@using SKV.PL.ClientSide.Components.Widget
@using SKV.PL.ClientSide.Components.DynamicTable

@using SKV.ML.Concrete.Model.UserModel

@using Config = SKV.Configuration

@section Scripts {
    @Linker.GetDirective("Widget")
    @Linker.GetDirective("CompileHtml")
    @Linker.GetDirective("DynamicTable")

    @Linker.DynamicTableModule()

    @Linker.GetService("Tools")
    @Linker.GetService("Request")
    @Linker.GetService("Location")

    @Linker.GetServiceExt("$tools")
    @Linker.GetServiceExt("$request")
    @Linker.GetServiceExt("$validation")

    @Linker.GetServiceExt("api/$users")
    @Linker.GetServiceExt("api/$roles")
}

@(ComponentFactory.Create<WidgetMvc>()
        .Id("UserManagerWidget")
        .Title(NameManager.GetName("UserManager"))
        .Body(body =>
        {
            body.Create<DynamicTableMvc>()
                .AngularTableSettingsFactoryName(Config.AngularFactoryNames.UserTableSettingsFactory)
                .AngularDynamicTableActionsController(Config.AngularControllerNames.UserManagerController)
                .AngularDynamicTableActionsControllerName(Config.AngularControllerAs.UserManagerControllerAs)
                .Columns(columns =>
                {
                    columns.Create<DynamicTableColumnMvc>().Field<User>(u => u.UserName).Width(20)
                                    .Type(TableColumnDataType.Text).Editable(true).Filterable(true);

                    columns.Create<DynamicTableColumnMvc>().Field<User>(u => u.Email).Width(20)
                                    .Type(TableColumnDataType.Text).Editable(true).Filterable(true);

                    columns.Create<DynamicTableColumnMvc>().Field<User>(u => u.PhoneNumber).Width(20)
                                    .Type(TableColumnDataType.Text).Editable(true).Filterable(true);

                    columns.Create<DynamicTableColumnMvc>().Field<User>(u => u.Profile.Name).Width(20)
                                    .Type(TableColumnDataType.Text).Editable(true).Filterable(true);

                    columns.Create<DynamicTableColumnMvc>().Field<User>("Actions").Width(20)
                                    .Type(TableColumnDataType.Actions).Editable(true).Filterable(false);
                })
                .Body(b =>
                {
                    b.Create<ContentMvc>().FromPartitalView(Html.Partial(Config.AngularModalNames.UserProfileModalName));
                    b.Create<ContentMvc>().FromPartitalView(Html.Partial(Config.AngularModalNames.UserCreatingModalName));
                })
                .Logic(logic => logic.Create<ContentMvc>().FromPartitalView(Html.Partial("UserManagerController")))
                .Editable(false)
                .Filterable(true)
                .Paginable(true)
                .RowActions(actions =>
                {
                    actions.Create<DynamicTableActionMvc>()
                           .Id(Config.AngularTableActionIds.ViewActionId)
                           .Icon("glyphicon glyphicon-folder-open")
                           .Title(string.Empty).Class("btn btn-flat btn-success  btn-md")
                           .Click(FunctionType.Referrence)
                           .Visible(FunctionType.Custom, @"function (row) { return true; }");

                    actions.Create<DynamicTableActionMvc>()
                           .Id(Config.AngularTableActionIds.DeleteActionId)
                           .Icon("glyphicon glyphicon-remove")
                           .Title(string.Empty).Class("btn btn-flat btn-danger  btn-md")
                           .Click(FunctionType.Referrence)
                           .Visible(FunctionType.Custom, @"function (row) { return (row.Id != null) && (row.Id != undefined); }");
                })
                .BottomManagmentPanel(panel => panel.Create<ContentMvc>().FromPartitalView(Html.Partial("TableBottomManagmentPanel")));
        })
        .Render()
)



